什么是KVM？
----

```
Kernel-based Virtual Machine的简称，是一个开源的系统虚拟化模块；
它可以在不改变linux镜像的情况下，同时运行多个虚拟机，把linux内核转换成一个虚拟机监视器(Hypervisor);
```
[维基百科](https://zh.wikipedia.org/wiki/%E5%9F%BA%E4%BA%8E%E5%86%85%E6%A0%B8%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA)

[kvm wiki](https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine)

[kvm百科](http://baike.baidu.com/link?url=VBJtn9Sfnh5Diap_0HXYYEzhrMcLyewXF8oWLVS-7An6CqQGfvO-JaDrVSp7wzFK92EjCW7zD4QO1aUj9CM-uGizDHDoh2lPgZvTu_GJ7rndpGbe6js1H5Hm6HSlL5ra)

[Hypervisor](https://zh.wikipedia.org/wiki/Hypervisor)

安装准备
----

- 确定机器有VT（virtualization Tech）

    ```
    $ grep vmx /proc/cpuinfo
    ```

- 确保BIOS开启了VT

- 确保内核版本较新(2.6.20以上)，支持KVM
    ```
    $ uname -a
    ```

安装KVM
----

Ubuntu / CentOS

- 安装命令
    ```
    $ sudo apt-get install kvm qemu qemu-kvm virt-manager kernel-package linux-source kqemu-source build-essential
    ```
    kvm安装成功后，会有/dev/kvm，如果不需要使用图形界面，只需安装前面3个即可；另外注意一下，ubuntu中没有kqemu-source的包，所以在ubuntu中可以不需要安装它，不会影响使用;
    
- 检查安装成功
    ```
    $ virsh -c qemu:///system list
    ```
    如果输入结果像下面这样的，那么成功了：
    ```
    Connecting to uri: qemu:///system
    Id Name State
    ```

- 注意事项

    CentOS安装时，先要选择SeLinux为enable，使用命令：
    ```
    # system-config-securitylevel-tui
    ```
    可查看或修改selinux的状态;

    CentOS以root身份登录时，安装命令如下：
    ```
    # yum install kvm kmod-kvm qemu
    ```
    再装入kvm模块：`modprobe kvm-intel`（Intel机器）或者`modprobe kvm-amd`（amd机器）

    可以使用下面命令检查是否装入kvm模块：
    ```
    # /sbin/lsmod | grep kvm
    ``` 
    输出kvm版本信息说明已经装入kvm模块

    安装好后，可使用qemu-kvm命令，输入该命令，如果系统显示未知命令，可查看/usr/libexec中是否还有qemu-kvm可执行文件，
    如果有，将其拷贝到/bin目录即可;如果确实按上面的步骤进行了，却在/bin，/usr/bin，/usr/libexec，/usr/sbin都找不到
    qemu-kvm可执行文件，那么执行下面命令：
    ```
    # yum provides "*/qemu-kvm"
    ```

    安装新的内核后，可能有些软件的版本过低，不兼容，无法启动；使用命令`yum update`来更新；


了解QEMU
----
qemu是一个开源的hosted hypervisor,配合kvm一起使用，虚拟机的运行速度可以达到原生硬件的运行速度；
详细的可以查看相关的wiki链接：[qemu wiki](https://en.wikipedia.org/wiki/QEMU)

可看qemu相关网站：[qemu-project.org](http://wiki.qemu-project.org/Features/KVM)


vncviewer是什么？
----

```
Virtual Network Computing（VNC）是一个远程系统，允许你和网络上的另一台计算机的虚拟桌面进行交互；
使用VNC，你可以运行图形界面应用，并在你本地上面显示；VNC的客户端和服务端都支持多个操作系统；
```
下载网址[https://github.com/TigerVNC/tigervnc/releases](https://github.com/TigerVNC/tigervnc/releases)



什么是xrdp？
----

```
xrdp一个开源的远程桌面协议服务器， 使用远程桌面协议来向用户展示图形界面；
```

安装xrdp
----

- 创建xrdp下载软件仓库
    ```
    $ sudo touch /etc/yum.repos.d/xrdp.repo
    ```

- 在该仓库文件中添加如下内容
    ```
    [xrdp]
    name = xrdp
    baseurl = http://li.nux.ro/download/nux/dextop/el7/x86_64/
    enabled = 1
    gpgcheck = 0
    ```

- 然后使用下面命令安装xrdp
    ```
    # yum -y install xrdp tigervnc-server
    ```

- 开启并启动xrdp，并检查是否已经启动
    ```
    # systemctl enable xrdp.service
    # systemctl start xrdp.service
    # systemctl -antup | grep xrdp
    ```

- 开启xrdp防火墙端口
    ```
    # firewall-cmd --permanent --zone=public --add-port=3389/tcp
    # firewall-cmd --reload
    ```
